<!DOCTYPE html>
<html>

<script>
var GITHUB_ISSUES_LINK =
  "https://api.github.com/repos/Tresre/blog/issues/";
var PATH_SEGMENTS_TO_SKIP = 1;

function isUrl(url) {
  // Regex from https://stackoverflow.com/a/3809435, with a modification to allow for TLDs of up to 24 characters
  return /^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,24}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)+$/.test(
    url
  );
}

function redirect() {
  var issueNumber = 1;

  var xhr = new XMLHttpRequest();

  xhr.onload = function () {
    try {
      var payload = JSON.parse(xhr.response);
      var message = payload.body;
      var title = payload.title;
      var avatar = payload.user;
      var date = payload.created_at;
      console.log("payload " + payload);
      console.log("pmessage " + message);
      console.log("title " + title);
      console.log("avatar " + avatar);
      console.log("date " + date);

      var isInvalidUrl =
        message === "Not Found" ||
        !title ||
        !isUrl(title) ||
        url.hostname === location.hostname;

      if (isInvalidUrl) {
        console.log("homepage");
      } else {
        console.log("title");
      }
    } catch (e) {
      console.log("homepage");
    }
  };

  xhr.onerror = function () {
    console.log("homepage");
  };
  xhr.open("GET", GITHUB_ISSUES_LINK + issueNumber);
  xhr.send();
  console.log("link " + "GET " + GITHUB_ISSUES_LINK + issueNumber);
  console.log("xhr " + xhr);
}

redirect();
</script>

</html>
